package management.entities.vulnerabilities;

import jakarta.persistence.Column;
import jakarta.persistence.Convert;
import jakarta.persistence.Entity;
import jakarta.persistence.Id;
import jakarta.persistence.Table;
import java.util.Collections;
import java.util.List;
import java.util.Set;
import management.converters.set.CvssInfoSetConverter;
import management.converters.set.StringSetConverter;
import management.entities.AbstractEntity;
import org.springframework.util.CollectionUtils;

@Entity
@Table(name = "vulnerabilities")
public class VulnerabilityDB extends AbstractEntity {

  //use enum, but write the integer value on db, for sorting and filtering
  private VulnerabilitySeverityDB severity;

  @Column(name = "cvss_score")
  private float cvssScore;

  @Column(columnDefinition = "text")
  private String description;

  @Column(name = "cvss_info_set", columnDefinition = "text")
  @Convert(converter = CvssInfoSetConverter.class)
  private Set<CvssInfoDB> cvssInfoSet;

  @Column(name = "source_link", columnDefinition = "text")
  private String sourceLink;

  @Column(name = "additional_references", columnDefinition = "text")
  @Convert(converter = StringSetConverter.class)
  private Set<String> additionalReferences;

  @Column(columnDefinition = "text")
  @Convert(converter = StringSetConverter.class)
  private Set<String> cwes;

  @Column(columnDefinition = "text")
  @Convert(converter = StringSetConverter.class)
  private Set<String> aliases;


  //TODO:
  /*
      POC / Exploit and source link

      CISA indication (is exploited in the wild)

      SANS Top 25

      CWE Top 25

      OWASP Top 10
   */

  public VulnerabilityDB() {
  }

  public VulnerabilityDB(String cveId) {
    calcAndSetId(cveId);
  }

  public VulnerabilitySeverityDB getSeverity() {
    return severity;
  }

  public VulnerabilityDB setSeverity(VulnerabilitySeverityDB severity) {
    this.severity = severity;
    return this;
  }

  public float getCvssScore() {
    return cvssScore;
  }

  public VulnerabilityDB setCvssScore(float cvssScore) {
    this.cvssScore = cvssScore;
    return this;
  }

  public String getDescription() {
    return description;
  }

  public VulnerabilityDB setDescription(String description) {
    this.description = description;
    return this;
  }

  public Set<CvssInfoDB> getCvssInfoSet() {
    return cvssInfoSet;
  }

  public VulnerabilityDB setCvssInfoSet(Set<CvssInfoDB> cvssInfoSet) {
    this.cvssInfoSet = cvssInfoSet;
    return this;
  }

  public String getSourceLink() {
    return sourceLink;
  }

  public VulnerabilityDB setSourceLink(String sourceLink) {
    this.sourceLink = sourceLink;
    return this;
  }

  public Set<String> getAdditionalReferences() {
    return additionalReferences;
  }

  public VulnerabilityDB setAdditionalReferences(Set<String> additionalReferences) {
    this.additionalReferences = additionalReferences;
    return this;
  }

  public Set<String> getCwes() {
    return cwes;
  }

  public VulnerabilityDB setCwes(Set<String> cwes) {
    this.cwes = cwes;
    return this;
  }

  public Set<String> getAliases() {
    return aliases;
  }

  public VulnerabilityDB setAliases(Set<String> aliases) {
    this.aliases = aliases;
    return this;
  }
}
